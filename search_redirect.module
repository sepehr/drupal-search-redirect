<?php
// $Id$

/**
 * @file
 * Contains necessary hook implementations for Search Redirect module.
 */

/**
 * Implements template_preprocess_search_results().
 */
function search_redirect_preprocess_search_results(&$variables) {

  if (count($variables['results']) == 1) {
    drupal_goto($variables['results'][0]['link']);
  }

}


/**
 * Implements hook_form_alter() for search_admin_settings form.
 */
function search_redirect_form_search_admin_settings_alter(&$form, $form_state) {
  $form['search_redirection'] = array(
    '#type' => 'fieldset',
    '#title' => t('Redirection settings'),
  );

  $form['search_redirection']['search_redirect'] = array(
    '#type' => 'checkboxes',
    '#return_value' => 1,
    '#options' => array(
      'node' => t('Redirect if there is a single result in node search <em>(to node page)</em>'),
      'user' => t('Redirect if there is a single result in user search <em>(to user profile)</em>'),
      'term' => t('Redirect if the search keyword exactly matches a term name. <em>(to that term page)</em>'),
      'message' => t('Set a message that notifies user that there were a redirection and provide a link to search without redirection.'),
    ),
    '#default_value' => variable_get('search_redirect_configs', array(
      'node' => 1,
      'user' => 1,
      'term' => 1,
      'message' => 1,
    )),
  );
}

